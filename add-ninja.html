<!DOCTYPE html>
<html>
  <head>
    <title>Add Ninja</title>
    <style>
      body {
        font-family: Arial;
        background: #000;
        color: white;
        text-align: center;
        padding: 20px;
      }
      input, button {
        padding: 10px;
        margin: 5px;
        border-radius: 8px;
      }
      #message {
        color: lime;
        font-weight: bold;
        margin: 10px 0;
      }
      table {
        margin-top: 20px;
        width: 100%;
        border-collapse: collapse;
        color: white;
      }
      th, td {
        border: 1px solid limegreen;
        padding: 10px;
      }
      th {
        background: #111;
      }
    </style>
  </head>
  <body>
    <h1>üåü Add New Ninja</h1>
    <form id="ninjaForm">
      <input type="text" id="name" placeholder="Name" required />
      <input type="text" id="nickname" placeholder="Nickname" required />
      <input type="text" id="gender" placeholder="Gender" required />
      <button type="submit">Add Ninja</button>
    </form>

    <div id="message"></div>

    <h2>üìú Ninja Roster</h2>
    <table id="ninjaTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Nickname</th>
          <th>Gender</th>
        </tr>
      </thead>
      <tbody id="ninjaBody">
        <!-- Filled dynamically -->
      </tbody>
    </table>

    <script>
      const form = document.getElementById("ninjaForm");
      const message = document.getElementById("message");
      const ninjaBody = document.getElementById("ninjaBody");

      // üíæ Load ninja data from function
      async function loadNinjas() {
        const res = await fetch("/.netlify/functions/get-ninjas");
        const data = await res.json();
        ninjaBody.innerHTML = "";
        data.forEach(n => {
          const row = `<tr>
            <td>${n.name}</td>
            <td>${n.nickname}</td>
            <td>${n.gender}</td>
          </tr>`;
          ninjaBody.innerHTML += row;
        });
      }

      // üì® Form submit handler
      form.addEventListener("submit", async e => {
        e.preventDefault();
        const ninja = {
          name: document.getElementById("name").value,
          nickname: document.getElementById("nickname").value,
          gender: document.getElementById("gender").value,
        };

        const res = await fetch("/.netlify/functions/add-ninja", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(ninja),
        });

        if (res.ok) {
          message.textContent = "‚úÖ Ninja added successfully!";
          form.reset();
          loadNinjas();
        } else {
          message.textContent = "‚ùå Failed to add ninja!";
        }
      });

      // üîÑ Load on page load
      loadNinjas();
    </script>
  </body>
</html>
